[["missing-values.html", "Chapter 4 Missing values", " Chapter 4 Missing values library(tidyverse) library(patchwork) library(ggnewscale) library(rtweet) library(sjmisc) library(readr) Here is the missing value plot function we defined in Problem Set 4. plot_missing &lt;- function(data, percent) { colnames(data) &lt;- abbreviate(colnames(data), minlength = 3) mp &lt;- data.frame(is.na(data)) %&gt;% group_by_all() %&gt;% count(name = &quot;count&quot;, sort = TRUE) %&gt;% ungroup() missing_patterns &lt;- mp %&gt;% select(c(1:ncol(mp)-1)) sorted_num_missing &lt;- sort(colSums(is.na(data)), decreasing = TRUE, index.return=TRUE) level &lt;- colnames(missing_patterns[sorted_num_missing$ix]) mid &lt;- level[ceiling(length(level)/2)] # get name of var located at the center of graph to put &quot;complete case&quot; tidy_missing_patterns &lt;- missing_patterns %&gt;% add_column(complete = if_else(rowSums(missing_patterns)==0, TRUE, FALSE)) %&gt;% rownames_to_column(&quot;id&quot;) %&gt;% gather(key, value, c(-id,-complete)) df &lt;- sorted_num_missing$x top_count &lt;- data.frame( name=names(df) , value=df) top_percent &lt;- data.frame( name=names(df) , value=df*100/nrow(data)) cmp &lt;- missing_patterns %&gt;% add_column(complete = if_else(rowSums(missing_patterns)==0, TRUE, FALSE)) side_count &lt;- data.frame( name=as.factor(seq.int(1:nrow(missing_patterns))), value=mp$count, complete=cmp$complete ) side_percent &lt;- data.frame( name=as.factor(seq.int(1:nrow(missing_patterns))), value=mp$count*100/nrow(data), complete=cmp$complete ) if (percent) { p1 &lt;- ggplot(top_percent, aes(x=fct_relevel(name, level), y=value)) + geom_bar(stat = &quot;identity&quot;, alpha=0.8, fill=&quot;#97b7f3&quot;) + ylim(0, 100) + ylab(&quot;% rows missing:&quot;) + theme(axis.title.x=element_blank()) + ggtitle(&quot;Missing value patterns&quot;) p2 &lt;-ggplot(side_percent, aes(x=fct_rev(name), y=value, fill=complete)) + geom_bar(stat = &quot;identity&quot;, alpha=0.8) + scale_fill_manual(values = c(&quot;#97b7f3&quot;, &quot;#6396ec&quot;)) + coord_flip() + ylab(&quot;% row&quot;) + ylim(0, 100) + theme(axis.title.y=element_blank()) + theme(legend.position = &quot;none&quot;) } else { p1 &lt;- ggplot(top_count, aes(x=fct_relevel(name, level), y=value)) + geom_bar(stat = &quot;identity&quot;, alpha=0.8, fill=&quot;#97b7f3&quot;) + ylab(&quot;num rows missing:&quot;) + theme(axis.title.x=element_blank()) + ggtitle(&quot;Missing value patterns&quot;) p2 &lt;- ggplot(side_count, aes(x=fct_rev(name), y=value, fill=complete)) + geom_bar(stat = &quot;identity&quot;, alpha=0.8) + scale_fill_manual(values = c(&quot;#97b7f3&quot;, &quot;#6396ec&quot;)) + coord_flip() + ylab(&quot;row count&quot;) + theme(axis.title.y=element_blank()) + theme(legend.position = &quot;none&quot;) } tidy_missing_patterns$id &lt;- as.factor(as.integer(tidy_missing_patterns$id)) p3 &lt;-ggplot(tidy_missing_patterns, aes(x = fct_relevel(key, level), y = fct_rev(id), fill = value)) + geom_tile(color = &quot;white&quot;, aes(alpha=complete)) + geom_text(aes(label = ifelse(complete == TRUE &amp; key==mid, &quot;complete cases&quot;, &quot;&quot;))) + scale_fill_manual(values = c(&quot;#b3b3b3&quot;, &quot;#9370da&quot;)) + scale_alpha_manual(values = c(0.7, 1.0)) + xlab(&quot;variable&quot;) + ylab(&quot;missing pattern&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;) p1 + plot_spacer() + p3 + p2 + plot_layout(widths = c(3,1), heights = unit(c(2,1), c(&#39;cm&#39;,&#39;null&#39;))) } df_combined &lt;- read_csv(&quot;./resources/data_combined_filtered_sentiment_old.csv&quot;) Then we checked how many missing values each column has. df_combined %&gt;% summarise_all(funs(sum(is.na(.)))) ## # A tibble: 1 × 19 ## created_at screen_name text retweet_count quote_count reply_count ## &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 0 0 33 0 12451 12451 ## # … with 13 more variables: followers_count &lt;int&gt;, group &lt;int&gt;, joy &lt;int&gt;, ## # trust &lt;int&gt;, anticipation &lt;int&gt;, sadness &lt;int&gt;, fear &lt;int&gt;, anger &lt;int&gt;, ## # surprise &lt;int&gt;, disgust &lt;int&gt;, positive &lt;int&gt;, negative &lt;int&gt;, ## # sentiment_score &lt;int&gt; plot_missing(df_combined, percent = TRUE) plot_missing(df_combined, percent = FALSE) It is hard to draw any significant conclusion from columns that have more than 90% of entries with missing values. Thus, we decided to remove all columns that have NA in more than 90% of entries. As a matter of fact, “quote_count” and “reply_count” columns have 100% of the entries with NA, so they will be removed from this filtering. df &lt;- df_combined %&gt;% select(which(colMeans(is.na(.)) &lt;= 0.9)) Also, there are 33 rows that have NA for text, which is the tweet. We can’t perform any sentiment analysis on rows that have no tweet, so we are removing those 33 rows. df &lt;- df %&gt;% drop_na(text) Also, we want to remove the rows that have NA for “positive” and “negative” sentiments. Having NA for those sentiments mean that the tweet doesn’t contain any information to calculate sentiment score, so we should remove those rows. df &lt;- df[!apply(is.na(df[,c(&quot;positive&quot;, &quot;negative&quot;)]), 1, all),] In addition, for sentiment columns - joy, trust, anticipation, sadness, fear, anger, surprise, disgust, positive, negative - we want to replace NAs with 0s because NA in those columns means that the tweet didn’t contain any word that pertains to those sentiments. Having 0s in place of NAs will ensure that all the sentiment columns have valid number entries, 0 meaning no count. df[c(&quot;joy&quot;, &quot;trust&quot;, &quot;anticipation&quot;, &quot;sadness&quot;, &quot;fear&quot;, &quot;anger&quot;, &quot;surprise&quot;, &quot;disgust&quot;, &quot;positive&quot;, &quot;negative&quot;)][is.na(df[c(&quot;joy&quot;, &quot;trust&quot;, &quot;anticipation&quot;, &quot;sadness&quot;, &quot;fear&quot;, &quot;anger&quot;, &quot;surprise&quot;, &quot;disgust&quot;, &quot;positive&quot;, &quot;negative&quot;)])] &lt;- 0 df %&gt;% summarise_all(funs(sum(is.na(.)))) ## # A tibble: 1 × 17 ## created_at screen_name text retweet_count followers_count group joy trust ## &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 0 0 0 0 0 0 0 0 ## # … with 9 more variables: anticipation &lt;int&gt;, sadness &lt;int&gt;, fear &lt;int&gt;, ## # anger &lt;int&gt;, surprise &lt;int&gt;, disgust &lt;int&gt;, positive &lt;int&gt;, negative &lt;int&gt;, ## # sentiment_score &lt;int&gt; plot_missing(df, percent = TRUE) plot_missing(df, percent = FALSE) write_csv(df, &quot;./resources/data_combined_filtered_sentiment.csv&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
