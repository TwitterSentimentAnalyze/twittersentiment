# Results


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(tidytext)
library(textdata)
library(dplyr)
library(ggpubr)
library(vcd)
library(scales)
library(ggalluvial)
```

## Data Exploration

Before diving into the sentiment analysis, we wanted to visualize some of the key metrics, namely the number tweets and the number of followers, to better understand the data we are working with, check the validity of data, and think about how they may impact the result of our analysis. As aforementioned, the groups we are interested in exploring are celebrities, medical, and politicians.


### The Number of Covid-19-related Tweets for Different Groups
```{r}
df <- read_csv("./resources/data_combined_filtered_sentiment.csv")
df$created_at <- as.Date(df$created_at)
# df2$date_group <-
# q1 = c
df$yearqtr <- paste(
  format(df$created_at, "%Y"),
  sprintf("%01i", (as.POSIXlt(df$created_at)$mon) %/% 3L + 1L), 
  sep = " Q")
df_qtr <- df %>% group_by(yearqtr) %>% count(group)
ggplot(data=df_qtr, aes(x=yearqtr, y=n, fill=group)) + 
  geom_bar(position = "dodge", stat = "identity") + 
  ggtitle("The Number of Covid-19 Tweets by Group") + 
  labs(x = "Year Quarter", y = "# of tweets")
```

We can observe that the number of tweets posted by medical was relatively low at the beginning of the pandemic and becomes far greater than the number of posts by the rest groups as time goes on. This seems reasonable since the medical may have gathered more information about Covid-19 as time goes by and have more to share with the public.  


### The Number of Followers for Different Groups

We also wanted to look into the number of followers by each group to understand the potential impact their tweets have on the public. 

```{r}
df_followers <- df %>% group_by(group) %>% summarise(followers_count = sum(followers_count))
ggplot(df_followers, aes(x=reorder(group, -followers_count), y= followers_count/1000000000)) + 
  geom_bar(stat='identity', fill="lightblue") + 
  scale_y_continuous(labels = comma) +
  ggtitle("Twitter Followers") +
  ylab("Followers Count (in billion)") +
  xlab("Group") +
  geom_text(aes(label=comma(followers_count)), vjust=2)
```


## What were the sentimental reactions of different groups to Covid-19 news?

### The Transitions of Sentiments (Positive/Negative) for Different Groups

As part of the sentiment analysis, we first visualized the change in sentiments over time.  
```{r}
date_group <- df %>% group_by(created_at, group)
avg <- date_group %>% summarise(avg_sentiment = mean(sentiment_score)) 
ggplot(data=avg, aes(x=created_at, y=avg_sentiment, color=group)) + 
  geom_smooth(method = "loess", span = .5, se = FALSE) + 
  scale_x_date(date_labels = "%Y %b", date_breaks = "1 month") +
  theme(axis.text.x=element_text(angle=60, hjust=1)) + 
  ggtitle("Sentiment Score Change") + 
  labs(x="Year Month", y="Avg Sentiment Score")
```

Score above 0 is generally associated with positive sentiment and below 0 with negative sentiment. We can observe that the scores for posts by all groups are generally above 0 over the timeline of our analysis which indicates that tweets posted leaned to be positive on average. Score 1 and -1 are the most extreme values for positive and negative sentiment, respectively. However, since we are looking at average scores, we cannot conclude that all posts were positive. To investigate this further, we will look at more visualizations below to expand the positive/negative sentiment into more detailed categories. Some of the useful insights are as follows:
  
1) It is noteworthy that the sentiment score of celebrities generally move in the same direction as the medical's score while politicians' score move in the opposite direction of the medical's score. 

2) Also, the celebrities' score change is much more dramatic than the medical's, and celebrities' sentiment seem to be the most positive among all groups. 

3) Although medical's and politician's sentiment seem to be fluctuating quite a bit due to the shape of the graph, but as will be shown in section 5.2.3, the change is not dramatic if we take into account the actual values. 

### Mosaic Plot
```{r}
df_mosaic <- df %>%  mutate(type = case_when(
         sentiment_score > 0.01  ~ "positive",
         sentiment_score < -0.01 ~ "negative",
         TRUE ~ "neutral"))

mosaic(type ~ group, direction = c("v", "h"), main = "Sentiment for Different Groups", df_mosaic, highlighting_fill = c("red","grey","darkgreen"))
```


We introduced a third sentiment "neutral" and created an overall sentiment mosaic graph. In this view, we look at the overall sentiment score and compare the proportion of the overall sentiment (positive, neutral, and negative) among groups instead of looking at the changes across time. We discovered some useful insights as follows: 

1) As we noted in the data exploration section, the number of tweets posted by medical is significantly larger than the others'. Therefore, the medical group takes the majority of the space in the mosaic plot.

2) To our surprise, the celebrities' sentiment is not at positive as depicted in the section 5.2.1. Rather than having a large positive score, it was the small negative score that propped up celebrities' sentiment score when all sentiments were summed up. 

3) Although the sentiments of politicians and medical seem to be moving in the opposite directions across time as depicted in section 5.2.1, their overall score is similar (Medical has slightly higher proportion for positive). 

### Stacked Barplot
```{r, fig.height=10, fig.width=10}
df_stack <- read_csv("./resources/data_combined_filtered_sentiment.csv")

df_stack$created_at <- as.Date(df_stack$created_at)

df_stack$yearqtr <- paste(
  format(df$created_at, "%Y"),
  sprintf("%01i", (as.POSIXlt(df$created_at)$mon) %/% 3L + 1L), 
  sep = " Q")

df_stack <- df_stack %>% select(c(group, yearqtr, joy, trust, anticipation, sadness, fear, anger, surprise, disgust)) 

df_stack[is.na(df_stack)] <- 0

df_p <- df_stack %>% filter(group == "politicians") 
df_m <- df_stack %>% filter(group == "medical")
df_c <- df_stack %>% filter(group == "celebrities")

df_p_qtr <- df_p %>% group_by(yearqtr) %>% dplyr::summarise(across(where(is.numeric), sum))
df_m_qtr <- df_m %>% group_by(yearqtr) %>% dplyr::summarise(across(where(is.numeric), sum))
df_c_qtr <- df_c %>% group_by(yearqtr) %>% dplyr::summarise(across(where(is.numeric), sum))

sent_cols <- c("joy", "trust", "anticipation", "sadness", "fear", "anger", "surprise", "disgust")

sents_p <- df_p_qtr %>% 
  gather(variable, value, -yearqtr)
sents_m <- df_m_qtr %>% 
  gather(variable, value, -yearqtr)
sents_c <- df_c_qtr %>% 
  gather(variable, value, -yearqtr)

plot_p <- ggplot(sents_p, aes(fill=variable, y=value, x=yearqtr)) + 
    geom_bar(position="fill", stat="identity") + xlab("Year Quarter") + ylab("Percentage")
plot_m <- ggplot(sents_m, aes(fill=variable, y=value, x=yearqtr)) +
    geom_bar(position="fill", stat="identity") + xlab("Year Quarter") + ylab("Percentage")
plot_c <- ggplot(sents_c, aes(fill=variable, y=value, x=yearqtr)) + 
    geom_bar(position="fill", stat="identity") + xlab("Year Quarter") + ylab("Percentage")

figure <- ggarrange(plot_p, plot_m, plot_c,
                    labels = c("Politicians", "Medical Associations", "Celebrities"),
                    common.legend = TRUE, legend="bottom",
                    ncol = 2, nrow = 2)

figure

```


We further divide up the sentiment categories to more granular levels:  "joy","trust","anticipation","sadness","fear","anger","surprise","disgust". We created a stacked barplot to show the change of sentiment across time for each group. 

1) Medical's sentiment do not change much across time relative to other groups' sentiment change. Sentiments like "anticipation", "fear", and "trust" comprise the biggest portions. It is notable that "fear" takes up as much portion as "trust" unlike other groups whose "fear" to do not take up as much portion as "trust".

2) Celebrities' sentiment change the most relatively speaking. The level of trust seem to fluctuate across time. Unlike medical, fear is not one of the biggest component. This is consistent with the findings from section 5.2.2 that the negative sentiment is relatively low for celebrities. Sentiments like "joy", "anticipation", and "trust" seem to be its biggest components. 

3) The most dominant sentiment for politicians seem to be "trust" across time. Politicians were suprised at the beginning of the outbreak as can be shown in the bigger purple box in 2020 Q1. But as time goes on, "surprise" takes up less portion relative to other sentiments.

We noticed that the stacked barchart, while useful in seeing the composition change across time, is not ideal for tracking how sentiments change across time for specific persons. Therefore, we resorted to an alluvial diagram to better understand how individual (or more accurately group) sentiment change over time. 



### Alluvial Diagram
```{r}
sentiment <- c("joy","trust","anticipation","sadness","fear","anger","surprise","disgust")
df_alluvial <- df
df_alluvial[,sentiment][is.na(df[, sentiment])] <- 0
# df[] <- 0
df_alluvial <- df_alluvial %>%
  group_by(yearqtr, screen_name, group) %>%
  summarise(joy = mean(joy),
            trust=mean(trust),
            anticipation=mean(anticipation),
            sadness = mean(sadness),
            fear = mean(fear),
            anger = mean(anger),
            surprise = mean(surprise),
            disgust = mean(disgust))
df_alluvial$dom_sentiment <- colnames(df_alluvial)[max.col(df_alluvial[,sentiment], ties.method = "first")+3]


df_alluvial %>% ggplot(aes(x = yearqtr,
                  stratum = dom_sentiment,
                  alluvium = screen_name,
                  label = dom_sentiment)) +
  geom_alluvium(aes(fill=group)) +
  geom_stratum() + 
  geom_text(stat = "stratum", size = 2) +
  labs(y="Number of Twitter Accounts", x="Year Quarter") +
  ggtitle("Sentiment Movement of Popular Twitter Accounts During Covid-19")
```

In lieu of creating an alluvia for every single tweet, we grouped the tweets by the specified grouping (politicians, medicals, and celebrities) and quarterly date, and we chose the most dominant sentiment for each grouping. As a result, some of the sentiments with low frequencies, such as anger, are not represented are not represented in the graph. These are the details we compromised to achieve a clearer big picture. We can cearly track changes of sentiments for each group.

1)




## Deep dive into reactions of politicians: 
We wanted to `

### Transition of Sentiments for Different Political Parties
```{r}
republican = c('Mike_Pence','tedcruz','marcorubio','randpaul','MittRomney')
democratic = c('BarackObama','JoeBiden','HillaryClinton','KamalaHarris','AOC')

df_politicians <- df %>% mutate (party = if_else(tolower(screen_name) %in% tolower(republican), "republican", if_else(tolower(screen_name) %in% tolower(democratic),"democratic","NA"))) %>% filter(group == "politicians")

date_group <- df_politicians %>% group_by(created_at, screen_name, group, party)
avg <- date_group %>% summarise(avg_sentiment = mean(sentiment_score))
avg <- avg %>% filter(group == "politicians")
date_range <- which(avg$created_at %in% as.Date(c("2020-10-01", "2020-12-01", "2020-07-01", "2021-04-01"))) 

ggplot(data=avg, aes(x=created_at, y=avg_sentiment, color=party)) + 
  geom_smooth(method = "loess", span = .5, se = FALSE) +
  scale_x_date(date_labels = "%Y %b", date_breaks = "1 month") +
  theme(axis.text.x=element_text(angle=60, hjust=1)) +
  xlab("Tweet Date") +
  ggtitle("Twitter Sentiments of Politicians") +
  ylab("Avg. Sentiment Score") + 
  geom_vline(xintercept = as.numeric(avg$created_at[date_range]), color = "black", linetype = "dotdash") +
  geom_text(aes(x = as.Date("2020-10-02"), y = 0.45, label = "a) Trump tested positive",color="republican")) +
  geom_text(aes(x = as.Date("2020-12-11"), y = 0.4, label = "b) 1st vaccine authorized",color="republican")) +
  geom_text(aes(x = as.Date("2020-07-10"), y = 0.5, label = "c) 2nd wave",color="republican")) +
  geom_text(aes(x = as.Date("2021-04-21"), y = 0.5, label = "d) 200+M vaccine administered",color="republican"))

```


## Deep dive into correlations of key metrics and sentiments:
- Do retweet/likes/reply have any correlation with certain sentiments?